# ===============================================
# Docker Compose para Slide API - Coolify Ready
# ===============================================
# 
# REDES REQUERIDAS:
# - coolify (default Coolify network)
# - h4csg4oo4k08wc848008gcgw (Supabase)
# - i4s8o8000kc040cgwcwowwwc (Réplica PostgreSQL)
#
# Coolify debe deployar este servicio conectado a estas redes
# ===============================================

services:
  slide-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: slide-api
    restart: unless-stopped
    environment:
      # JVM Configuration
      JAVA_OPTS: "-Xms512m -Xmx2g"
      SPRING_PROFILES_ACTIVE: production
      
      # Supabase PostgreSQL (red: h4csg4oo4k08wc848008gcgw)
      SUPABASE_DB_HOST: supabase-db-h4csg4oo4k08wc848008gcgw
      SUPABASE_DB_USER: postgres
      SUPABASE_DB_PASSWORD: 1fqsZrj7ATbnjSjCKShU2h5A2wi0SIrl
      
      # Réplica PostgreSQL Odoo (red: i4s8o8000kc040cgwcwowwwc)
      REPLICA_DB_HOST: postgres-replica-i4s8o8000kc040cgwcwowwwc
      REPLICA_DB_PORT: "5432"
      REPLICA_DB_PASSWORD: odoo
    ports:
      - "8080:8080"
    networks:
      - coolify
      - supabase
      - replica
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

networks:
  coolify:
    external: true
    name: coolify
  supabase:
    external: true
    name: h4csg4oo4k08wc848008gcgw
  replica:
    external: true
    name: i4s8o8000kc040cgwcwowwwc
